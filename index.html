<!DOCTYPE html>
<html>
  <head>
    <title>Generate Paytm QR Code</title>
    <meta charset="UTF-8" />
  </head>
  <body>
    <h1>Generate Paytm QR Code</h1>
    <form onsubmit="generateQRCode(); return false;">
      <label>Amount:</label>
      <input type="number" id="amount" />
      <br />
      <button type="submit">Generate QR Code</button>
    </form>
    <div id="qr_code"></div>
    <div id="status"></div>
    <script>
      function generateQRCode() {
        var amount = document.getElementById("amount").value;
        var url = "https://securegw.paytm.in/paytmchecksum/paytmQRGenerate";
        var payload = {
          merchantId: "ncyhFY55833815626624",
          amount: amount
        };
        var headers = {
          "Content-Type": "application/json",
          "x-mid": "ncyhFY55833815626624",
          "x-encrequest": "true"
        };
        fetch(url, {
          method: "POST",
          headers: headers,
          body: JSON.stringify(payload)
        })
          .then(function(response) {
            return response.json();
          })
          .then(function(data) {
            var qr_code_data = data.body.qrCode;
            var qr_code_image = document.createElement("img");
            qr_code_image.src = "data:image/jpeg;base64," + qr_code_data;
            document.getElementById("qr_code").appendChild(qr_code_image);
            setTimeout(checkTransactionStatus, 60000, data.body.txnId);
          })
          .catch(function(error) {
            console.log(error);
          });
      }

      function checkTransactionStatus(txnId) {
        var url = "https://securegw.paytm.in/merchant-status/getTxnStatus";
        var payload = {
          orderId: txnId,
          merchantId: "ncyhFY55833815626624"
        };
        var headers = {
          "Content-Type": "application/json",
          "x-mid": "ncyhFY55833815626624",
          "x-encrequest": "true"
        };
        fetch(url, {
          method: "POST",
          headers: headers,
          body: JSON.stringify(payload)
        })
          .then(function(response) {
            return response.json();
          })
          .then(function(data) {
            var status_message = "Transaction Status: " + data.body.resultInfo.resultStatus;
            document.getElementById("status").textContent = status_message;
            setTimeout(checkTransactionStatus, 60000, txnId);
          })
          .catch(function(error) {
            console.log(error);
          });
      }
    </script>
  </body>
</html>
