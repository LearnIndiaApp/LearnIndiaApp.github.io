<!DOCTYPE html>
<html>
<head>
    <title>Paytm QR Code Generator</title>
</head>
<body>
    <div>
        <h1>Paytm QR Code Generator</h1>
        <p>Enter the transaction amount:</p>
        <input type="number" id="amount">
        <button onclick="generateQR()">Generate QR Code</button>
    </div>
    <div id="qr-code"></div>
    <div id="transaction-status"></div>

    <script>
        function generateQR() {
            const amount = document.getElementById("amount").value;

            const data = {
                "mid": "ncyhFY55833815626624",
                "orderId": "ORDER123",
                "txnAmount": {
                    "value": amount,
                    "currency": "INR",
                },
                "userInfo": {
                    "custId": "CUST123",
                },
            };

            fetch("https://learnindiaapp.github.io/proxy/paytmQRGenerate", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(response => {
                const qrCodeData = response.body.qrCode;
                const qrCodeImg = document.createElement("img");
                qrCodeImg.src = qrCodeData;
                document.getElementById("qr-code").appendChild(qrCodeImg);

                // Start checking transaction status after 1 minute
                setTimeout(checkTransactionStatus, 60000, response.body.txnId);
            })
            .catch(error => {
                console.error(error);
            });
        }

        function checkTransactionStatus(txnId) {
            const data = {
                "mid": "ncyhFY55833815626624",
                "orderId": "ORDER123",
                "txnId": txnId,
            };

            fetch("https://learnindiaapp.github.io/proxy/paytmCheckTransactionStatus", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(response => {
                const status = response.body.resultInfo.resultStatus;
                const statusMsg = response.body.resultInfo.resultMsg;
                const statusDiv = document.getElementById("transaction-status");

                if (status === "TXN_SUCCESS") {
                    statusDiv.innerHTML = "Transaction Successful!";
                } else if (status === "TXN_FAILURE") {
                    statusDiv.innerHTML = "Transaction Failed: " + statusMsg;
                } else {
                    // Transaction still in progress, check again after 1 minute
                    statusDiv.innerHTML = "Transaction Status: " + statusMsg;
                    setTimeout(checkTransactionStatus, 60000, txnId);
                }
            })
            .catch(error => {
                console.error(error);
            });
        }
    </script>
</body>
</html>
